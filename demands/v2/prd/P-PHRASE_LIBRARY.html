<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>语习集 - 短语库</title>
    <script src="https://unpkg.byted-static.com/coze/space_ppt_lib/1.0.3-alpha.12/lib/tailwindcss.js"></script>
    <script src="https://unpkg.byted-static.com/fortawesome/fontawesome-free/6.7.2/js/all.min.js" data-auto-replace-svg="nest"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#2563eb',
                        secondary: '#7c3aed',
                        tertiary: '#059669',
                        success: '#10b981',
                        danger: '#ef4444',
                        info: '#3b82f6',
                        'text-primary': '#1f2937',
                        'text-secondary': '#6b7280',
                        'bg-card': '#ffffff',
                        'bg-secondary': '#f8fafc',
                        'border-light': '#e5e7eb'
                    },
                    fontFamily: {
                        'sans': ['-apple-system', 'BlinkMacSystemFont', 'Segoe UI', 'Roboto', 'sans-serif']
                    },
                    boxShadow: {
                        'card': '0 2px 8px rgba(0, 0, 0, 0.06)',
                        'card-hover': '0 4px 16px rgba(0, 0, 0, 0.1)'
                    },
                    borderRadius: {
                        'card': '16px'
                    }
                }
            }
        }
    </script>
    <style>
        .safe-top {
            padding-top: env(safe-area-inset-top);
        }
        .safe-bottom {
            padding-bottom: env(safe-area-inset-bottom);
        }
        
        .card-hover:hover {
            transform: translateY(-2px);
            transition: all 0.3s ease;
        }
        
        .filter-modal {
            backdrop-filter: blur(10px);
            background: rgba(0, 0, 0, 0.5);
        }
        
        .filter-content {
            background: white;
            border-radius: 20px 20px 0 0;
            transform: translateY(100%);
            transition: transform 0.3s ease;
        }
        
        .filter-content.show {
            transform: translateY(0);
        }
        
        .loading-spinner {
            border: 2px solid #f3f3f3;
            border-top: 2px solid #2563eb;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .empty-state {
            opacity: 0.6;
        }
    </style>
</head>
<body class="bg-bg-secondary font-sans">
    <!-- 状态栏 -->
    <div id="status-bar" class="bg-white safe-top">
        <div class="flex justify-between items-center px-6 py-2 text-sm font-medium text-gray-900">
            <span>9:41</span>
            <div class="flex items-center space-x-1">
                <i class="fas fa-signal text-xs"></i>
                <i class="fas fa-wifi text-xs"></i>
                <i class="fas fa-battery-three-quarters text-xs"></i>
            </div>
        </div>
    </div>

    <!-- 主要内容区域 -->
    <div id="main-content" class="pb-20">
        <!-- 顶部导航栏 -->
        <header id="top-header" class="bg-white px-6 py-4 shadow-sm">
            <div id="header-content" class="flex items-center justify-between">
                <!-- 搜索框 -->
                <div id="search-container" class="flex-1 mr-4">
                    <div class="relative">
                        <input 
                            type="text" 
                            id="search-input"
                            placeholder="搜索短语..." 
                            class="w-full pl-10 pr-4 py-3 bg-gray-50 border-0 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-primary focus:bg-white transition-all"
                        >
                        <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 text-sm"></i>
                    </div>
                </div>
                
                <!-- 筛选按钮 -->
                <button id="filter-btn" class="w-10 h-10 bg-gray-50 rounded-xl flex items-center justify-center">
                    <i class="fas fa-filter text-gray-600 text-sm"></i>
                </button>
            </div>
        </header>

        <!-- 筛选标签栏 -->
        <section id="filter-tabs" class="px-6 py-4">
            <div id="tabs-container" class="flex space-x-3 overflow-x-auto">
                <button id="tab-all" class="px-4 py-2 bg-primary text-white text-sm rounded-full whitespace-nowrap">
                    全部
                </button>
                <button id="tab-daily" class="px-4 py-2 bg-gray-100 text-gray-600 text-sm rounded-full whitespace-nowrap">
                    日常问候
                </button>
                <button id="tab-shopping" class="px-4 py-2 bg-gray-100 text-gray-600 text-sm rounded-full whitespace-nowrap">
                    购物消费
                </button>
                <button id="tab-restaurant" class="px-4 py-2 bg-gray-100 text-gray-600 text-sm rounded-full whitespace-nowrap">
                    餐饮服务
                </button>
                <button id="tab-travel" class="px-4 py-2 bg-gray-100 text-gray-600 text-sm rounded-full whitespace-nowrap">
                    旅行出行
                </button>
            </div>
        </section>

        <!-- 短语列表 -->
        <section id="phrases-section" class="px-6">
            <div id="phrases-header" class="flex items-center justify-between mb-4">
                <h2 id="phrases-title" class="text-lg font-semibold text-text-primary">短语库</h2>
                <span id="phrases-count" class="text-sm text-text-secondary">共 450 个短语</span>
            </div>
            
            <div id="phrases-list" class="space-y-3">
                <!-- 短语卡片将通过JavaScript动态生成 -->
            </div>
            
            <!-- 加载更多指示器 -->
            <div id="loading-indicator" class="flex justify-center items-center py-6 hidden">
                <div class="loading-spinner"></div>
                <span class="ml-2 text-sm text-text-secondary">加载中...</span>
            </div>
            
            <!-- 空状态 -->
            <div id="empty-state" class="text-center py-12 hidden">
                <div class="w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-search text-gray-400 text-2xl"></i>
                </div>
                <h3 class="text-lg font-medium text-text-primary mb-2">未找到相关短语</h3>
                <p class="text-sm text-text-secondary">试试其他关键词或筛选条件</p>
            </div>
        </section>
    </div>

    <!-- 筛选弹窗 -->
    <div id="filter-modal" class="fixed inset-0 z-50 filter-modal hidden">
        <div id="filter-overlay" class="absolute inset-0"></div>
        <div id="filter-content" class="absolute bottom-0 left-0 right-0 filter-content">
            <div class="p-6">
                <!-- 弹窗头部 -->
                <div id="filter-header" class="flex items-center justify-between mb-6">
                    <h3 class="text-lg font-semibold text-text-primary">筛选条件</h3>
                    <button id="close-filter-btn" class="w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center">
                        <i class="fas fa-times text-gray-600 text-sm"></i>
                    </button>
                </div>
                
                <!-- 难度筛选 -->
                <div id="difficulty-filter" class="mb-6">
                    <h4 class="text-sm font-medium text-text-primary mb-3">难度等级</h4>
                    <div class="flex flex-wrap gap-2">
                        <button id="difficulty-all" class="px-3 py-2 bg-primary text-white text-sm rounded-full">全部</button>
                        <button id="difficulty-beginner" class="px-3 py-2 bg-gray-100 text-gray-600 text-sm rounded-full">入门</button>
                        <button id="difficulty-intermediate" class="px-3 py-2 bg-gray-100 text-gray-600 text-sm rounded-full">进阶</button>
                        <button id="difficulty-advanced" class="px-3 py-2 bg-gray-100 text-gray-600 text-sm rounded-full">精通</button>
                    </div>
                </div>
                
                <!-- 场景筛选 -->
                <div id="scene-filter" class="mb-6">
                    <h4 class="text-sm font-medium text-text-primary mb-3">使用场景</h4>
                    <div class="space-y-2">
                        <label class="flex items-center">
                            <input type="checkbox" id="scene-daily-check" class="w-4 h-4 text-primary border-gray-300 rounded focus:ring-primary" checked>
                            <span class="ml-3 text-sm text-text-primary">日常问候</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" id="scene-shopping-check" class="w-4 h-4 text-primary border-gray-300 rounded focus:ring-primary" checked>
                            <span class="ml-3 text-sm text-text-primary">购物消费</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" id="scene-restaurant-check" class="w-4 h-4 text-primary border-gray-300 rounded focus:ring-primary" checked>
                            <span class="ml-3 text-sm text-text-primary">餐饮服务</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" id="scene-travel-check" class="w-4 h-4 text-primary border-gray-300 rounded focus:ring-primary" checked>
                            <span class="ml-3 text-sm text-text-primary">旅行出行</span>
                        </label>
                    </div>
                </div>
                
                <!-- 操作按钮 -->
                <div id="filter-actions" class="flex space-x-3">
                    <button id="reset-filter-btn" class="flex-1 py-3 bg-gray-100 text-gray-600 text-sm font-medium rounded-xl">
                        重置
                    </button>
                    <button id="apply-filter-btn" class="flex-1 py-3 bg-primary text-white text-sm font-medium rounded-xl">
                        应用筛选
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 底部导航栏 -->
    <nav id="bottom-nav" class="fixed bottom-0 left-0 right-0 bg-white border-t border-border-light flex justify-around items-center h-16 px-2 safe-bottom z-40">
        <a id="nav-home" href="#" class="flex flex-col items-center p-2 text-text-secondary">
            <i class="fas fa-home text-xl"></i>
            <span class="text-xs mt-0.5">首页</span>
        </a>
        <a id="nav-library" href="#" class="flex flex-col items-center p-2 text-primary">
            <i class="fas fa-book text-xl"></i>
            <span class="text-xs mt-0.5 font-medium">短语库</span>
        </a>
        <a id="nav-scene" href="#" class="flex flex-col items-center p-2 text-text-secondary">
            <i class="fas fa-map-marker-alt text-xl"></i>
            <span class="text-xs mt-0.5">场景学习</span>
        </a>
        <a id="nav-profile" href="#" class="flex flex-col items-center p-2 text-text-secondary">
            <i class="fas fa-user text-xl"></i>
            <span class="text-xs mt-0.5">我的</span>
        </a>
    </nav>

    <script>
        // 模拟短语数据
        const mockPhrases = [
            {
                id: 'phrase1',
                english: 'Could you please...',
                chinese: '请问你可以...吗？',
                difficulty: 'beginner',
                scenes: ['daily'],
                mastered: false
            },
            {
                id: 'phrase2',
                english: 'I\'m looking for...',
                chinese: '我在找...',
                difficulty: 'beginner',
                scenes: ['shopping'],
                mastered: true
            },
            {
                id: 'phrase3',
                english: 'Can I get a table for two?',
                chinese: '我可以要一张两人桌吗？',
                difficulty: 'intermediate',
                scenes: ['restaurant'],
                mastered: false
            },
            {
                id: 'phrase4',
                english: 'How much does this cost?',
                chinese: '这个多少钱？',
                difficulty: 'beginner',
                scenes: ['shopping'],
                mastered: true
            },
            {
                id: 'phrase5',
                english: 'Where is the nearest restroom?',
                chinese: '最近的洗手间在哪里？',
                difficulty: 'intermediate',
                scenes: ['travel'],
                mastered: false
            },
            {
                id: 'phrase6',
                english: 'I\'d like to order...',
                chinese: '我想要点...',
                difficulty: 'intermediate',
                scenes: ['restaurant'],
                mastered: true
            },
            {
                id: 'phrase7',
                english: 'Could you repeat that?',
                chinese: '你能再说一遍吗？',
                difficulty: 'beginner',
                scenes: ['daily'],
                mastered: false
            },
            {
                id: 'phrase8',
                english: 'What time does the store open?',
                chinese: '商店几点开门？',
                difficulty: 'intermediate',
                scenes: ['shopping'],
                mastered: true
            },
            {
                id: 'phrase9',
                english: 'I need to book a flight.',
                chinese: '我需要订一张机票。',
                difficulty: 'advanced',
                scenes: ['travel'],
                mastered: false
            },
            {
                id: 'phrase10',
                english: 'Thank you for your help.',
                chinese: '谢谢你的帮助。',
                difficulty: 'beginner',
                scenes: ['daily'],
                mastered: true
            }
        ];

        // 当前筛选条件
        let currentFilters = {
            scene: 'all',
            difficulty: 'all',
            search: '',
            selectedScenes: ['daily', 'shopping', 'restaurant', 'travel']
        };

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            initializePage();
            renderPhrases();
            setupEventListeners();
        });

        function initializePage() {
            // 解析URL参数
            const urlParams = getUrlParams();
            if (urlParams.scene_id) {
                currentFilters.scene = urlParams.scene_id;
                updateSceneTabSelection(urlParams.scene_id);
            }
        }

        function setupEventListeners() {
            // 搜索框事件
            document.querySelector('#search-input').addEventListener('input', function(e) {
                currentFilters.search = e.target.value.toLowerCase();
                renderPhrases();
            });

            // 筛选按钮事件
            document.querySelector('#filter-btn').addEventListener('click', function() {
                showFilterModal();
            });

            // 筛选弹窗事件
            document.querySelector('#close-filter-btn').addEventListener('click', function() {
                hideFilterModal();
            });

            document.querySelector('#filter-overlay').addEventListener('click', function() {
                hideFilterModal();
            });

            // 难度筛选按钮事件
            document.querySelectorAll('[id^="difficulty-"]').forEach(button => {
                button.addEventListener('click', function() {
                    document.querySelectorAll('[id^="difficulty-"]').forEach(btn => {
                        btn.classList.remove('bg-primary', 'text-white');
                        btn.classList.add('bg-gray-100', 'text-gray-600');
                    });
                    this.classList.remove('bg-gray-100', 'text-gray-600');
                    this.classList.add('bg-primary', 'text-white');
                    
                    const difficulty = this.id.replace('difficulty-', '');
                    currentFilters.difficulty = difficulty;
                });
            });

            // 场景标签事件
            document.querySelectorAll('[id^="tab-"]').forEach(tab => {
                tab.addEventListener('click', function() {
                    document.querySelectorAll('[id^="tab-"]').forEach(t => {
                        t.classList.remove('bg-primary', 'text-white');
                        t.classList.add('bg-gray-100', 'text-gray-600');
                    });
                    this.classList.remove('bg-gray-100', 'text-gray-600');
                    this.classList.add('bg-primary', 'text-white');
                    
                    const scene = this.id.replace('tab-', '');
                    currentFilters.scene = scene;
                    renderPhrases();
                });
            });

            // 筛选应用按钮事件
            document.querySelector('#apply-filter-btn').addEventListener('click', function() {
                applyFilters();
                hideFilterModal();
            });

            // 重置筛选按钮事件
            document.querySelector('#reset-filter-btn').addEventListener('click', function() {
                resetFilters();
            });

            // 底部导航栏事件
            document.querySelector('#nav-home').addEventListener('click', function(e) {
                e.preventDefault();
                window.location.href = 'P-HOME.html';
            });

            document.querySelector('#nav-library').addEventListener('click', function(e) {
                e.preventDefault();
                // 已在短语库页面，无需操作
            });

            document.querySelector('#nav-scene').addEventListener('click', function(e) {
                e.preventDefault();
                window.location.href = 'P-SCENE_LIST.html';
            });

            document.querySelector('#nav-profile').addEventListener('click', function(e) {
                e.preventDefault();
                window.location.href = 'P-USER_PROFILE.html';
            });

            // 搜索框焦点效果
            const searchInput = document.querySelector('#search-input');
            searchInput.addEventListener('focus', function() {
                this.parentElement.classList.add('ring-2', 'ring-primary');
            });
            searchInput.addEventListener('blur', function() {
                this.parentElement.classList.remove('ring-2', 'ring-primary');
            });
        }

        function updateSceneTabSelection(sceneId) {
            document.querySelectorAll('[id^="tab-"]').forEach(tab => {
                tab.classList.remove('bg-primary', 'text-white');
                tab.classList.add('bg-gray-100', 'text-gray-600');
            });
            
            const targetTab = document.querySelector(`#tab-${sceneId}`);
            if (targetTab) {
                targetTab.classList.remove('bg-gray-100', 'text-gray-600');
                targetTab.classList.add('bg-primary', 'text-white');
            }
        }

        function showFilterModal() {
            document.querySelector('#filter-modal').classList.remove('hidden');
            setTimeout(() => {
                document.querySelector('#filter-content').classList.add('show');
            }, 10);
        }

        function hideFilterModal() {
            document.querySelector('#filter-content').classList.remove('show');
            setTimeout(() => {
                document.querySelector('#filter-modal').classList.add('hidden');
            }, 300);
        }

        function applyFilters() {
            // 收集选中的场景
            const selectedScenes = [];
            document.querySelectorAll('[id$="-check"]').forEach(checkbox => {
                if (checkbox.checked) {
                    const scene = checkbox.id.replace('-check', '').replace('scene-', '');
                    selectedScenes.push(scene);
                }
            });
            currentFilters.selectedScenes = selectedScenes;
            
            renderPhrases();
        }

        function resetFilters() {
            // 重置难度筛选
            document.querySelectorAll('[id^="difficulty-"]').forEach(btn => {
                btn.classList.remove('bg-primary', 'text-white');
                btn.classList.add('bg-gray-100', 'text-gray-600');
            });
            document.querySelector('#difficulty-all').classList.remove('bg-gray-100', 'text-gray-600');
            document.querySelector('#difficulty-all').classList.add('bg-primary', 'text-white');
            
            // 重置场景复选框
            document.querySelectorAll('[id$="-check"]').forEach(checkbox => {
                checkbox.checked = true;
            });
            
            currentFilters.difficulty = 'all';
            currentFilters.selectedScenes = ['daily', 'shopping', 'restaurant', 'travel'];
        }

        function filterPhrases() {
            return mockPhrases.filter(phrase => {
                // 搜索筛选
                if (currentFilters.search && 
                    !phrase.english.toLowerCase().includes(currentFilters.search) && 
                    !phrase.chinese.toLowerCase().includes(currentFilters.search)) {
                    return false;
                }
                
                // 场景筛选（顶部标签）
                if (currentFilters.scene !== 'all' && !phrase.scenes.includes(currentFilters.scene)) {
                    return false;
                }
                
                // 难度筛选
                if (currentFilters.difficulty !== 'all' && phrase.difficulty !== currentFilters.difficulty) {
                    return false;
                }
                
                // 筛选弹窗场景筛选
                if (!currentFilters.selectedScenes.some(scene => phrase.scenes.includes(scene))) {
                    return false;
                }
                
                return true;
            });
        }

        function renderPhrases() {
            const filteredPhrases = filterPhrases();
            const phrasesList = document.querySelector('#phrases-list');
            const phrasesCount = document.querySelector('#phrases-count');
            const emptyState = document.querySelector('#empty-state');
            
            // 更新短语数量
            phrasesCount.textContent = `共 ${filteredPhrases.length} 个短语`;
            
            if (filteredPhrases.length === 0) {
                phrasesList.innerHTML = '';
                emptyState.classList.remove('hidden');
                return;
            }
            
            emptyState.classList.add('hidden');
            
            // 生成短语卡片HTML
            const phrasesHTML = filteredPhrases.map(phrase => {
                const difficultyClass = getDifficultyClass(phrase.difficulty);
                const difficultyText = getDifficultyText(phrase.difficulty);
                const sceneText = getSceneText(phrase.scenes[0]);
                const sceneClass = getSceneClass(phrase.scenes[0]);
                const masteredIcon = phrase.mastered ? 
                    '<i class="fas fa-check-circle text-success text-sm ml-2"></i>' : 
                    '<i class="fas fa-circle text-gray-300 text-sm ml-2"></i>';
                
                return `
                    <div id="phrase-card-${phrase.id}" class="bg-white rounded-card shadow-card p-4 card-hover cursor-pointer" data-phrase-id="${phrase.id}">
                        <div class="flex items-center justify-between">
                            <div class="flex-1">
                                <div class="flex items-center mb-1">
                                    <h3 class="text-base font-semibold text-text-primary">${phrase.english}</h3>
                                    ${masteredIcon}
                                </div>
                                <p class="text-sm text-text-secondary mb-2">${phrase.chinese}</p>
                                <div class="flex items-center space-x-2">
                                    <span class="px-2 py-1 ${sceneClass} text-xs rounded-full">${sceneText}</span>
                                    <span class="px-2 py-1 ${difficultyClass} text-xs rounded-full">${difficultyText}</span>
                                </div>
                            </div>
                            <button class="phrase-audio-btn w-10 h-10 bg-gray-50 rounded-full flex items-center justify-center ml-4" data-phrase-id="${phrase.id}">
                                <i class="fas fa-play text-gray-600 text-sm"></i>
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
            
            phrasesList.innerHTML = phrasesHTML;
            
            // 为生成的短语卡片添加事件监听器
            attachPhraseCardEvents();
        }

        function attachPhraseCardEvents() {
            // 短语卡片点击事件
            document.querySelectorAll('[id^="phrase-card-"]').forEach(card => {
                card.addEventListener('click', function(e) {
                    // 如果点击的是音频按钮，不触发卡片点击
                    if (e.target.closest('.phrase-audio-btn')) {
                        return;
                    }
                    
                    const phraseId = this.dataset.phraseId;
                    window.location.href = `P-PHRASE_DETAIL.html?phrase_id=${phraseId}`;
                });
                
                card.addEventListener('click', function() {
                    this.style.transform = 'scale(0.98)';
                    setTimeout(() => {
                        this.style.transform = 'translateY(-2px)';
                    }, 100);
                });
            });
            
            // 音频按钮点击事件
            document.querySelectorAll('.phrase-audio-btn').forEach(button => {
                button.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const icon = this.querySelector('i');
                    if (icon.classList.contains('fa-play')) {
                        icon.classList.remove('fa-play');
                        icon.classList.add('fa-pause');
                        setTimeout(() => {
                            icon.classList.remove('fa-pause');
                            icon.classList.add('fa-play');
                        }, 2000);
                    }
                });
            });
        }

        function getDifficultyClass(difficulty) {
            switch(difficulty) {
                case 'beginner': return 'bg-green-50 text-green-600';
                case 'intermediate': return 'bg-blue-50 text-blue-600';
                case 'advanced': return 'bg-purple-50 text-purple-600';
                default: return 'bg-gray-50 text-gray-600';
            }
        }

        function getDifficultyText(difficulty) {
            switch(difficulty) {
                case 'beginner': return '入门';
                case 'intermediate': return '进阶';
                case 'advanced': return '精通';
                default: return '未知';
            }
        }

        function getSceneText(scene) {
            switch(scene) {
                case 'daily': return '日常问候';
                case 'shopping': return '购物消费';
                case 'restaurant': return '餐饮服务';
                case 'travel': return '旅行出行';
                default: return '其他';
            }
        }

        function getSceneClass(scene) {
            switch(scene) {
                case 'daily': return 'bg-blue-50 text-blue-600';
                case 'shopping': return 'bg-purple-50 text-purple-600';
                case 'restaurant': return 'bg-orange-50 text-orange-600';
                case 'travel': return 'bg-green-50 text-green-600';
                default: return 'bg-gray-50 text-gray-600';
            }
        }

        function getUrlParams() {
            const params = {};
            const queryString = window.location.search.substring(1);
            const urlParams = new URLSearchParams(queryString);
            
            for(const [key, value] of urlParams.entries()) {
                params[key] = value;
            }
            return params;
        }
    </script>
</body>
</html>