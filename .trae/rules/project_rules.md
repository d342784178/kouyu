# 语习集 - AI助手工作指南

> 本文档是AI助手的核心工作规范，包含项目约束、文档索引和维护要求。

---

## 一、项目级注意事项（必读）

### 1.1 核心约束

| 约束项 | 说明 | 违反后果 |
|--------|------|----------|
| **依赖变更** | 涉及依赖变更需重启服务器 | 变更不生效 |
| **代码变更** | 每次代码变更后必须测试 | 引入Bug |
| **临时文件** | 临时文件放到 `.trae/temp/{sessionId}` | 污染工作区 |
| **语言规范** | 对话用中文，代码注释用中文 | 不符合规范 |
| **文档优先** | 对于任何操作都优先查看文档, 任何修改也需要评估是否维护到文档上 | 不符合规范 |



## 二、文档索引系统

### 2.1 文档清单

| 序号 | 文档路径 | 内容简介 | 优先级 | 阅读时间 |
|------|----------|----------|--------|----------|
| 1 | `docs/00-core/core-project-overview-v1.0.md` | 项目背景、核心功能、技术架构、目标用户 | P0 | 10分钟 |
| 2 | `docs/00-core/core-quickstart-v1.0.md` | 环境要求、安装步骤、配置说明、常见问题 | P0 | 15分钟 |
| 3 | `docs/01-architecture/arch-tech-stack-v1.0.md` | 技术栈详解、依赖版本、选型理由、环境变量 | P1 | 15分钟 |
| 4 | `docs/01-architecture/arch-project-structure-v1.0.md` | 项目的目录结构、文件组织规范及关键文件说明 | P1 | 10分钟 |
| 5 | `docs/01-architecture/arch-database-schema-v1.0.md` | 表结构定义、字段说明、数据格式、查询示例 | P1 | 20分钟 |
| 6 | `docs/02-development/dev-coding-standards-v1.0.md` | 编码规范、组件规范、TypeScript规范、导入顺序 | P1 | 15分钟 |
| 7 | `docs/03-api/api-endpoints-v1.0.md` | 所有API端点、请求/响应格式、错误码说明 | P1 | 30分钟 |
| 8 | `docs/04-operations/ops-deployment-v1.0.md` | 部署架构、环境配置、生产部署、回滚策略 | P1 | 15分钟 |
| 9 | `docs/04-operations/ops-troubleshooting-v1.0.md` | 常见问题及解决方案、调试技巧、性能优化 | P1 | 20分钟 |

### 2.2 使用场景指引

| 你的任务 | 应查阅的文档 |
|----------|-------------|
| 首次了解项目 | 文档1（项目概述） |
| 搭建开发环境 | 文档2（快速开始） |
| 开发新功能 | 文档4（项目结构）+ 文档6（编码规范） |
| 调用API | 文档7（API接口） |
| 修改数据库 | 文档5（数据库设计） |
| 部署项目 | 文档8（部署流程） |
| 排查问题 | 文档9（常见问题） |

### 2.3 关键源代码文件

| 文件路径 | 用途说明 |
|----------|----------|
| `src/lib/db/schema.ts` | 数据库表结构定义（Drizzle ORM） |
| `src/lib/llm.ts` | GLM-4 API调用封装 |
| `src/lib/audioUrl.ts` | 音频URL构建工具（支持多存储协议） |
| `src/types.ts` | 全局TypeScript类型定义 |
| `src/hooks/useAudio.ts` | 音频播放状态管理Hook |

---

## 三、文档工程维护规范

### 3.1 维护责任声明

**AI助手必须严格遵守以下文档维护规范。任何对项目代码的变更，都必须同步更新相关文档，确保文档与代码实现完全一致。**

### 3.2 变更触发条件

当发生以下任一情况时，必须更新对应文档：

| 变更类型 | 必须更新的文档 | 更新内容 |
|----------|---------------|----------|
| 新增/修改API接口 | `docs/03-api/api-endpoints-v1.0.md` | 接口定义、请求/响应格式、错误码 |
| 修改数据库表结构 | `docs/01-architecture/arch-database-schema-v1.0.md` | 表定义、字段说明、数据格式 |
| 新增/删除核心功能 | `docs/00-core/core-project-overview-v1.0.md` | 核心功能列表、项目亮点 |
| 新增/升级技术栈 | `docs/01-architecture/arch-tech-stack-v1.0.md` | 技术栈列表、依赖版本、选型理由 |
| 修改项目目录结构 | `docs/01-architecture/arch-project-structure-v1.0.md` | 目录说明、文件组织、关键文件索引 |
| 修改编码规范 | `docs/02-development/dev-coding-standards-v1.0.md` | 命名规范、组件规范、代码示例 |
| 修改环境配置要求 | `docs/00-core/core-quickstart-v1.0.md` | 环境变量、配置步骤、常见问题 |
| 修改部署流程 | `docs/04-operations/ops-deployment-v1.0.md` | 部署步骤、配置说明 |
| 新增/修改子文档 | **本文档（project_rules.md）** | 文档索引表（第2.1节） |

### 3.3 文档更新操作规范

#### 步骤1：更新目标文档

```markdown
# 文档标题

> 版本: v1.1                    ← 更新版本号（小版本+1）
> 最后更新: 2026-02-25          ← 更新日期
> 优先级: P0/P1/P2
> 阅读时间: X分钟

... 文档内容 ...

## 变更日志

| 版本 | 日期 | 变更内容 | 作者 |
|------|------|----------|------|
| v1.1 | 2026-02-25 | 新增XX功能说明 | AI |
| v1.0 | 2026-02-24 | 初始版本 | - |
```

#### 步骤2：更新本文档索引（如新增/修改子文档）

如果操作涉及新增、删除或重命名子文档，**必须同步更新本文档第2.1节的"文档清单"表格**，确保：
- 文档序号连续
- 路径准确无误
- 简介反映最新内容
- 优先级标注正确

#### 步骤3：执行自动化测试验证

**每次更新./docs/目录下的文档后，必须执行自动化测试脚本验证文档质量：**

```bash
# 执行完整的文档质量验证
node docs/tests/scripts/run-all-tests.js

# 或单独执行特定测试
node docs/tests/scripts/run-structure-tests.js         # 仅结构测试
node docs/tests/scripts/run-content-tests-llm.js       # 仅内容测试（LLM版本）
```

**测试通过标准：**
- 结构合规性测试通过率 ≥ 95%
- 内容有效性测试通过率 ≥ 75%
- 无死链或断链
- 所有元信息格式正确

**质量状态标记：**
- 测试通过后，文档更新方可提交
- 测试报告自动保存至 `docs/tests/doc-quality-report.json`

文档自动化测试的详细说明（包括测试脚本位置、覆盖范围、维护责任、更新流程等）请查阅：

**[docs/tests/README.md](../../docs/tests/README.md)**


#### 步骤4：验证链接有效性

更新后执行以下检查：
- [ ] 文档内所有相对链接可正常跳转
- [ ] 代码示例与当前实现一致
- [ ] 版本号已递增
- [ ] 变更日志已记录
- [ ] **自动化测试已通过**

### 3.5 禁止事项

以下行为严格禁止：

- ❌ **代码已变更但文档未更新** - 导致文档与实现不一致
- ❌ **新增子文档但未更新project_rules索引** - 导致文档无法被发现
- ❌ **文档中出现与代码不符的示例** - 误导后续开发者
- ❌ **无效的文档链接** - 导致404错误
- ❌ **过时的环境配置说明** - 导致环境搭建失败
- ❌ **删除文档但未更新索引** - 导致死链

### 3.6 文档模板标准

所有子文档必须包含以下元信息头部：

```markdown
# 文档标题

> 版本: v1.0
> 最后更新: YYYY-MM-DD
> 优先级: P0/P1/P2
> 阅读时间: X分钟

---

## 文档简介

一句话说明本文档的目的和范围。

---

## 目录

- [章节1](#章节1)
- [章节2](#章节2)

---

## 正文内容

...

---

## 变更日志

| 版本 | 日期 | 变更内容 | 作者 |
|------|------|----------|------|
| v1.0 | YYYY-MM-DD | 初始版本 | - |
```

---

## 附录：项目速查

### 技术栈

Next.js 14 + TypeScript + PostgreSQL + Drizzle ORM + Tailwind CSS + GLM-4-Flash

### 快速启动

```bash
pnpm install
cp .env.example .env.local
# 配置 DATABASE_URL, GLM_API_KEY 等
pnpm dev
```

### 场景分类统计

| 分类 | ID前缀 | 数量 |
|------|--------|------|
| 日常 | `daily_` | 31 |
| 职场 | `workplace_` | 25 |
| 留学 | `study_abroad_` | 15 |
| 旅行 | `travel_` | 20 |
| 社交 | `social_` | 20 |
| **总计** | - | **111** |

---

*本文档版本: v3.1 | 最后更新: 2026-02-24 | 面向AI助手*
